!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.mason=t(require("react")):e.mason=t(e.react)}(window,(function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0});var o=/(<%[^%>]+%>)/g;t.processValue=function(e,t,r){if(o.test(e)){var a=e.match(o),i=e;return a&&a.forEach((function(e){var o=n(e.match(/^<%([^%>]+)%>$/)||["",""],2),a=o[0],u=o[1],s="SELF"===u?r:t[u]&&t[u].value;i=i.replace(a,"string"!=typeof s?JSON.stringify(s):s)})),i}return"string"!=typeof e?JSON.stringify(e):e},t.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(2),a=function e(t,r,a){switch(t.type){case o.OperationType.ATOMIC:var i=n.processValue(t.leftOperand,r,a),u=n.processValue(t.rightOperand,r,a);return function(e,t,r){switch(e){case o.ComparisonOperators.EQ:return t===r;case o.ComparisonOperators.NOT_EQ:return t!==r;case o.ComparisonOperators.LT:return t<r;case o.ComparisonOperators.LTE:return t<=r;case o.ComparisonOperators.GT:return t>r;case o.ComparisonOperators.GTE:return t>=r}}(t.operator,i,u);case o.OperationType.COMPOUND:var s=e(t.leftOperand,r),c=e(t.rightOperand,r);return function(e,t,r){switch(e){case o.CompoundOperators.AND:return t&&r;case o.CompoundOperators.OR:return t||r}}(t.operator,s,c)}};t.booleanProcessor=function(e,t,r){return"boolean"==typeof e?e:a(e,t,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EQ="=",e.NOT_EQ="!=",e.LT="<",e.LTE="<=",e.GT=">",e.GTE=">="}(t.ComparisonOperators||(t.ComparisonOperators={})),function(e){e.AND="&&",e.OR="||"}(t.CompoundOperators||(t.CompoundOperators={})),function(e){e.ATOMIC="ATOMIC",e.COMPOUND="COMPOUND"}(t.OperationType||(t.OperationType={})),function(e){e.REQUIRED="REQUIRED",e.REGEX="REGEX",e.CUSTOM="CUSTOM",e.RANGE="RANGE",e.LENGTH="LENGTH",e.JSON="JSON"}(t.ValidationTypes||(t.ValidationTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(4))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var s=u(r(5)),c=r(6),l=r(7),d=r(1),p=r(0),f=s.createContext,v=s.memo,y=s.useReducer,h=s.createElement,O=s.useContext,b=s.useEffect,g=s.useMemo,m=s.forwardRef,E=s.useRef,P=s.useImperativeHandle,T=function(e,t){var r=t.type,n=t.payload;switch(r){case"ADD_ENTRY":return Object.assign(Object.assign({},e),i({},n.id,n.props));case"UPDATE_ENTRY":return Object.assign(Object.assign({},e),i({},n.id,Object.assign(Object.assign({},e[n.id]),n.props)));case"UPDATE_PROP":if(!e[n.id])throw new Error("Invalid component id ".concat(n.id," provided for prop updation"));return Object.assign(Object.assign({},e),i({},n.id,Object.assign(Object.assign({},e[n.id]),i({},n.prop,n.value))));case"REPLACE_STATE_VALUES":for(var o=Object.assign({},e),u=0,s=Object.entries(n);u<s.length;u++){var c=a(s[u],2),l=c[0],d=c[1];o[l].value=d.value}return o;default:return e}},j=f(null);function A(e,t,r){if(Array.isArray(e))return e.forEach((function(e){return A(e,t,r)})),t;var n=e.meta,o=e.id,a=e.children;return r&&r.get(o)?t[o]=Object.assign(Object.assign({},t[o]||{}),{value:r.get(o),initialValue:r.get(o)}):n&&void 0!==n.value&&(t[o]=Object.assign(Object.assign({},t[o]||{}),{value:n.value,initialValue:n.value})),a&&a.forEach((function(e){return A(e,t,r)})),t}var R=m((function(e,t){var r=e.children,n=e.initialState,o=void 0===n?{}:n,i=e.instance,u=a(y(T,o),2),s=u[0],c=u[1];P(t,(function(){return{setRootState:function(e,t){var r=A(e,Object.assign({},s),t);c({type:"REPLACE_STATE_VALUES",payload:r})}}}),[s]);var d=Object.values(s).some((function(e){var t=e.validations;return t&&t.hasErrors}));if(i.hasErrors!==d){var p=i.options.onErrorStateChange;p&&p(d),i.hasErrors=d}i.isPristine=i.checkIfValuesPristine(s),i.isInvalid=!function e(t,r,n){if(Array.isArray(t))return t.reduce((function(t,o){return t&&e(o,r,n)}),n);if(t.validations){var o=l.validator(t.validations,r[t.id].value);if(Object.values(o).some(Boolean))return!1}return!t.children||e(t.children,r,n)}(i.config.config,s,!0);var f={value:{state:s,dispatch:function(e){return c(e),s}}};return h(j.Provider,f,r)}));t.RootComponent=v(R);var S=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.components=new Map,this.hasErrors=!1,this.isPristine=!0,this.isInvalid=!1,this.config=t,this.elementsMap=r,this.options=n||{},this.renderConfigNode=this.renderConfigNode.bind(this),this.currentRootStateSnapshot={},this.rootComponentRef=null}var r,i,u;return r=e,(i=[{key:"renderConfigNode",value:function(e){var t=this,r=e.id,o=e.type,i=e.meta,u=void 0===i?{}:i,f=e.data,y=e.events,m=void 0===y?{}:y,E=e.validations,P=e.children,A=e.style,R=e.show,S=e.disabled,_=this.options,C=_.dataProcessors,w=void 0===C?{}:C,N=_.onStateChange,U=_.resolvers,D=this.elementsMap.get(o);if(!D)throw new Error("No component exists for type ".concat(o));var M,V=v((function(e){var n=O(j),o=n.state,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;return function(n){var o=n.type,a=n.payload,i="UPDATE_PROP"===o&&"value"===a.prop;if(i){var u=a.value,s=a.id,c=l.validator(t,u),d=Object.values(c).some(Boolean);e({type:"UPDATE_PROP",payload:{id:s,prop:"validations",value:{hasErrors:d,errors:c}}})}var p=e({type:o,payload:a});r&&r.onStateChange&&i&&r.onStateChange(T(p,{type:o,payload:a}))}}(n.dispatch,E,{onStateChange:N});t.currentRootStateSnapshot=o;var p=g((function(){return Object.entries(m).reduce((function(e,t){var n=a(t,2),u=n[0],s=n[1];return e[u]=function(e,t){Array.isArray(s)?s.forEach((function(n){c.handleEvent(n,{id:r,event:e,dataProcessors:w,value:t,resolvers:U},i,o)})):c.handleEvent(s,{id:r,event:e,dataProcessors:w,value:t,resolvers:U},i,o)},e}),{})}),[m,o,i]);b((function(){i({type:o[r]?"UPDATE_ENTRY":"ADD_ENTRY",payload:{id:r,props:Object.assign(Object.assign(Object.assign({},u),e),{value:o[r]?o[r].value:u.value})}}),f&&c.handleEvent(f,{id:r,dataProcessors:w,resolvers:U},i,o)}),[]);var v=function(e,t){var r=t.rootState,n=t.resolvers,o=t.instance;if(void 0!==e){if("boolean"==typeof e)return e;if(e.type){if("CUSTOM"===e.type){var a=e.meta;if(n&&n[a.name])return n[a.name](o)}return d.booleanProcessor(e,r)}}}(S,{rootState:o,resolvers:U,instance:t}),y=s.useMemo((function(){return h(D,Object.assign(Object.assign(Object.assign({},o[r]?o[r]:Object.assign(Object.assign({},u),e)),{disabled:v}),p),e.children)}),[o[r],p,e.children]),P=void 0===R||d.booleanProcessor(R,o);return b((function(){!P&&o[r]&&void 0!==o[r].value&&i({type:"UPDATE_PROP",payload:{id:r,prop:"value",value:u.value}})}),[P]),P?h("section",e,y):null}));return V.displayName=(M=r,"".concat(p.capitalize(M),"MasonWrapper")),h.apply(void 0,[V,{key:r,style:A,id:r}].concat(n(P?P.map(this.renderConfigNode):[])))}},{key:"checkIfValuesPristine",value:function(e){return Object.values(e).reduce((function(e,t){var r=t.value,n=t.initialValue;return void 0===n?e&&!r:e&&JSON.stringify(n)===JSON.stringify(r)}),!0)}},{key:"constructInitialState",value:function(e,t){return A(e,t,this.options.initialValues)}},{key:"getValuesFromState",value:function(e){return Object.entries(e).reduce((function(e,t){var r=a(t,2),n=r[0],o=r[1];return void 0!==o.value&&(e[n]=o.value),e}),{})}},{key:"getCurrentValuesSnapshot",value:function(){return this.getValuesFromState(this.currentRootStateSnapshot)}},{key:"setValue",value:function(e){this.rootComponentRef&&this.rootComponentRef.current.setRootState(this.config.config,e)}},{key:"render",value:function(){var e=this;return v((function(){var r=e.config.config,n=e.constructInitialState(r,{});return e.rootComponentRef=E(),h(t.RootComponent,{initialState:n,ref:e.rootComponentRef,instance:e},Array.isArray(r)?r.map(e.renderConfigNode):[e.renderConfigNode(r)])}))}}])&&o(r.prototype,i),u&&o(r,u),e}();t.ReactConfigRenderer=S},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(1);t.handleEvent=function(e,t,r,i){var u=t.id,s=t.event,c=void 0===s?null:s,l=t.dataProcessors,d=t.value,p=void 0===d?void 0:d,f=t.resolvers,v=e.type,y=e.when;if(y&&!1===a.booleanProcessor(y,i,p))return;switch(v){case"AJAX_CALL":var h=e.meta,O=h.endpoint,b=h.queryParams,g=h.dataProcessor,m=h.fieldId,E=h.fieldIds,P=h.credentials,T=void 0===P?"omit":P;r({type:"UPDATE_PROP",payload:{id:m||u,prop:"loading",value:!0}}),i[m||u]&&i[m||u].error&&r({type:"UPDATE_PROP",payload:{id:m||u,prop:"error",value:null}}),fetch("".concat(O,"?").concat(b?function(e,t,r){return Object.entries(e).reduce((function(e,a){var i=n(a,2),u=i[0],s=i[1];return e.push("".concat(u,"=").concat(o.processValue(s,t,r))),e}),[]).join("&")}(b,i,void 0!==p?p:c?c.target.value:null):""),{credentials:T}).then((function(e){if(e.ok)return e.json();throw e})).then((function(e){return g&&l[g]?l[g](e):e})).then((function(e){if(r({type:"UPDATE_PROP",payload:{id:m||u,prop:"loading",value:!1}}),E)for(var t=0,o=Object.entries(E);t<o.length;t++){var a=n(o[t],2),i=a[0],s=a[1];r({type:"UPDATE_PROP",payload:{id:i,prop:"datasource",value:l&&l[s]&&l[s](e)}})}else r({type:"UPDATE_PROP",payload:{id:m||u,prop:"datasource",value:e}})})).catch((function(e){r({type:"UPDATE_PROP",payload:{id:m||u,prop:"loading",value:!1}}),e instanceof Response?e.text().then((function(e){console.error("Error while fetching datasource: ",e),r({type:"UPDATE_PROP",payload:{id:m||u,prop:"error",value:e}})})):(console.error("Error while fetching datasource: ",e),r({type:"UPDATE_PROP",payload:{id:m||u,prop:"error",value:e.message}}))}));break;case"SET_DATASOURCE":var j=e.meta,A=j.data,R=j.fieldId;r({type:"UPDATE_PROP",payload:{id:R||u,prop:"datasource",value:A}});break;case"SET_VALUE":var S=e.meta,_=null;_=void 0!==S&&S.value?S.value:void 0!==p?p:c&&c.target.value,r({type:"UPDATE_PROP",payload:{id:S&&S.fieldId||u,prop:"value",value:_}});break;case"CUSTOM":var C=e.meta;f&&f[C.name]&&f[C.name]({event:c,value:p,id:u});break;default:throw new Error("No valid data type provided in config")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.validator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.reduce((function(e,r){switch(r.type){case n.ValidationTypes.REQUIRED:e[n.ValidationTypes.REQUIRED]=""===t||null==t?"This field is required":"";break;case"REGEX":var o=r.meta.pattern;new RegExp(o).test(t)?e[n.ValidationTypes.REGEX]="":e[n.ValidationTypes.REGEX]="Field value doesn't match the pattern";break;case"LENGTH":var a=r.meta,i=a.min,u=a.max;t.length<i?e[n.ValidationTypes.LENGTH]="Minimum length of ".concat(i," is needed"):t.length>u?e[n.ValidationTypes.LENGTH]="Maximum length of ".concat(u," is allowed"):e[n.ValidationTypes.LENGTH]="";break;case"RANGE":var s=r.meta,c=s.min,l=s.max;e[n.ValidationTypes.RANGE]=t>c&&t<l?"":"The value should be in the range of ".concat(c," and ").concat(l)}return e}),{})}}])}));
//# sourceMappingURL=index.js.map