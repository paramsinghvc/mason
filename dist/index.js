!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.mason=t(require("react")):e.mason=t(e.react)}(window,(function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0});var a=/(<%[^%>]+%>)/g;t.processValue=function(e,t,r){if(a.test(e)){var o=e.match(a),i=e;return o&&o.forEach((function(e){var a=n(e.match(/^<%([^%>]+)%>$/)||["",""],2),o=a[0],s=a[1],u="SELF"===s?r:t[s]&&t[s].value;i=i.replace(o,"string"!=typeof u?JSON.stringify(u):u)})),i}return"string"!=typeof e?JSON.stringify(e):e},t.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(2),o=function e(t,r,o){switch(t.type){case a.OperationType.ATOMIC:var i=n.processValue(t.leftOperand,r,o),s=n.processValue(t.rightOperand,r,o);return function(e,t,r){switch(e){case a.ComparisonOperators.EQ:return t===r;case a.ComparisonOperators.NOT_EQ:return t!==r;case a.ComparisonOperators.LT:return t<r;case a.ComparisonOperators.LTE:return t<=r;case a.ComparisonOperators.GT:return t>r;case a.ComparisonOperators.GTE:return t>=r}}(t.operator,i,s);case a.OperationType.COMPOUND:var u=e(t.leftOperand,r),c=e(t.rightOperand,r);return function(e,t,r){switch(e){case a.CompoundOperators.AND:return t&&r;case a.CompoundOperators.OR:return t||r}}(t.operator,u,c)}};t.booleanProcessor=function(e,t,r){return"boolean"==typeof e?e:o(e,t,r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EQ="=",e.NOT_EQ="!=",e.LT="<",e.LTE="<=",e.GT=">",e.GTE=">="}(t.ComparisonOperators||(t.ComparisonOperators={})),function(e){e.AND="&&",e.OR="||"}(t.CompoundOperators||(t.CompoundOperators={})),function(e){e.ATOMIC="ATOMIC",e.COMPOUND="COMPOUND"}(t.OperationType||(t.OperationType={})),function(e){e.REQUIRED="REQUIRED",e.REGEX="REGEX",e.CUSTOM="CUSTOM",e.RANGE="RANGE",e.LENGTH="LENGTH",e.JSON="JSON"}(t.ValidationTypes||(t.ValidationTypes={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(4))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var u=s(r(5)),c=r(6),l=r(7),d=r(1),p=r(0),f=u.createContext,v=u.memo,y=u.useReducer,h=u.createElement,O=u.useContext,b=u.useEffect,m=u.useMemo,g=u.forwardRef,E=u.useRef,T=u.useImperativeHandle,P=function(e){return"".concat(p.capitalize(e),"MasonWrapper")},j=function(e,t){var r=t.type,n=t.payload;switch(r){case"ADD_ENTRY":return Object.assign(Object.assign({},e),i({},n.id,n.props));case"UPDATE_ENTRY":return Object.assign(Object.assign({},e),i({},n.id,Object.assign(Object.assign({},e[n.id]),n.props)));case"UPDATE_PROP":if(!e[n.id])throw new Error("Invalid component id ".concat(n.id," provided for prop updation"));return Object.assign(Object.assign({},e),i({},n.id,Object.assign(Object.assign({},e[n.id]),i({},n.prop,n.value))));case"REPLACE_STATE_VALUES":for(var a=Object.assign({},e),s=0,u=Object.entries(n);s<u.length;s++){var c=o(u[s],2),l=c[0],d=c[1];a[l].value=d.value}return a;default:return e}},S=f(null);function A(e,t,r){if(Array.isArray(e))return e.forEach((function(e){return A(e,t,r)})),t;var n=e.meta,a=e.id,o=e.children;return r&&void 0!==r[a]?t[a]=Object.assign(Object.assign({},t[a]||{}),{value:r[a],initialValue:r[a]}):n&&void 0!==n.value&&(t[a]=Object.assign(Object.assign({},t[a]||{}),{value:n.value,initialValue:n.value})),o&&o.forEach((function(e){return A(e,t,r)})),t}var R=g((function(e,t){var r=e.children,n=e.initialState,a=void 0===n?{}:n,i=e.instance,s=o(y(j,a),2),u=s[0],c=s[1];T(t,(function(){return{setRootState:function(e,t){var r=A(e,Object.assign({},u),t);c({type:"REPLACE_STATE_VALUES",payload:r})}}}),[u]);var d=Object.values(u).some((function(e){var t=e.validations;return t&&t.hasErrors}));if(i.hasErrors!==d){var p=i.options.onErrorStateChange;p&&p(d),i.hasErrors=d}i.isPristine=i.checkIfValuesPristine(u),i.isInvalid=!function e(t,r,n,a){if(Array.isArray(t))return t.reduce((function(t,o){return t&&e(o,r,n,a)}),n);if(t.validations){var o=l.validator(t.validations,r[t.id].value,{validators:a&&a.validators});if(Object.values(o).some(Boolean))return!1}return!t.children||e(t.children,r,n,a)}(i.config.config,u,!0,{validators:i.options.validators});var f={value:{state:u,dispatch:function(e){return c(e),u}}};return h(S.Provider,f,r)}));t.RootComponent=v(R);var C=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.componentsMap={},this.hasErrors=!1,this.isPristine=!0,this.isInvalid=!1,this.config=t,this.elementsMap=r,this.options=n||{},this.renderConfigNode=this.renderConfigNode.bind(this),this.currentRootStateSnapshot={},this.rootComponentRef=null}var r,i,s;return r=e,(i=[{key:"renderConfigNode",value:function(e){var t=this,r=e.id,a=e.type,i=e.meta,s=void 0===i?{}:i,p=e.data,f=e.events,y=void 0===f?{}:f,g=e.validations,E=e.children,T=e.style,A=e.show,R=e.disabled,C=this.options,_=C.dataProcessors,N=void 0===_?{}:_,w=C.onStateChange,V=C.resolvers,M=C.validators,U=this.elementsMap[a];if(!U)throw new Error("No component exists for type ".concat(a));var D,I=v((function(e){var n=O(S),a=n.state,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;return function(n){var a=n.type,o=n.payload,i="UPDATE_PROP"===a&&"value"===o.prop;if(i){var s=o.value,u=o.id,c=l.validator(t,s,{validators:r&&r.validators}),d=Object.values(c).some(Boolean);e({type:"UPDATE_PROP",payload:{id:u,prop:"validations",value:{hasErrors:d,errors:c}}})}var p=e({type:a,payload:o});return r&&r.onStateChange&&i&&r.onStateChange(j(p,{type:a,payload:o})),p}}(n.dispatch,g,{onStateChange:w,validators:M});t.currentRootStateSnapshot=a;var f=m((function(){return Object.entries(y).reduce((function(t,n){var s=o(n,2),u=s[0],l=s[1];return t[u]=function(t,n){Array.isArray(l)?l.forEach((function(o){c.handleEvent(o,{id:r,event:t,dataProcessors:N,value:n,resolvers:e.resolvers},i,a)})):c.handleEvent(l,{id:r,event:t,dataProcessors:N,value:n,resolvers:e.resolvers},i,a)},t}),{})}),[y,a,i]);b((function(){i({type:a[r]?"UPDATE_ENTRY":"ADD_ENTRY",payload:{id:r,props:Object.assign(Object.assign(Object.assign({},s),e),{value:a[r]?a[r].value:s.value})}}),p&&c.handleEvent(p,{id:r,dataProcessors:N,resolvers:e.resolvers},i,a)}),[]);var v=function(e,t){var r=t.rootState,n=t.resolvers,a=t.instance;if(void 0!==e){if("boolean"==typeof e)return e;if(e.type){if("CUSTOM"===e.type){var o=e.meta;if(n&&n[o.name])return n[o.name](a)}return d.booleanProcessor(e,r)}}}(R,{rootState:a,resolvers:e.resolvers,instance:t}),E=m((function(){return h(U,Object.assign(Object.assign(Object.assign({},a[r]?a[r]:Object.assign(Object.assign(Object.assign({},s),e),{id:r})),{disabled:v}),f),e.children)}),[a[r],f,e.children]),T=void 0===A||d.booleanProcessor(A,a);b((function(){!T&&a[r]&&void 0!==a[r].value&&i({type:"UPDATE_PROP",payload:{id:r,prop:"value",value:s.value}})}),[T]);var P=Object.assign({},e);return delete P.resolvers,T?u.isValidElement(E)?E:h("section",P,E):null})),k=P(r);return this.componentsMap[k]?D=this.componentsMap[k]:(I.displayName=P(r),this.componentsMap[k]=I,D=I),h.apply(void 0,[D,{key:r,style:T,id:r,resolvers:V}].concat(n(E?E.map(this.renderConfigNode):[])))}},{key:"checkIfValuesPristine",value:function(e){return Object.values(e).reduce((function(e,t){var r=t.value,n=t.initialValue;return void 0===n?e&&!r:e&&JSON.stringify(n)===JSON.stringify(r)}),!0)}},{key:"constructInitialState",value:function(e,t){return A(e,t,this.options.initialValues)}},{key:"getValuesFromState",value:function(e){return Object.entries(e).reduce((function(e,t){var r=o(t,2),n=r[0],a=r[1];return void 0!==a.value&&(e[n]=a.value),e}),{})}},{key:"getCurrentValuesSnapshot",value:function(){return this.getValuesFromState(this.currentRootStateSnapshot)}},{key:"setValue",value:function(e){this.rootComponentRef&&this.rootComponentRef.current.setRootState(this.config.config,e)}},{key:"render",value:function(){var e=this;return v((function(r){var n=e.config.config;r.resolvers&&(e.options.resolvers=r.resolvers);var a=e.constructInitialState(n,{});return e.rootComponentRef=E(),h(t.RootComponent,{initialState:a,ref:e.rootComponentRef,instance:e},Array.isArray(n)?n.map(e.renderConfigNode):[e.renderConfigNode(n)])}))}}])&&a(r.prototype,i),s&&a(r,s),e}();t.ReactConfigRenderer=C},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1);t.handleEvent=function(e,t,r,i){var s=t.id,u=t.event,c=void 0===u?null:u,l=t.dataProcessors,d=t.value,p=void 0===d?void 0:d,f=t.resolvers,v=e.type,y=e.when;if(y&&!1===o.booleanProcessor(y,i,p))return;switch(v){case"AJAX_CALL":var h=e.meta,O=h.endpoint,b=h.queryParams,m=h.dataProcessor,g=h.fieldId,E=h.fieldIds,T=h.credentials,P=void 0===T?"omit":T;r({type:"UPDATE_PROP",payload:{id:g||s,prop:"loading",value:!0}}),i[g||s]&&i[g||s].error&&r({type:"UPDATE_PROP",payload:{id:g||s,prop:"error",value:null}}),fetch("".concat(O,"?").concat(b?function(e,t,r){return Object.entries(e).reduce((function(e,o){var i=n(o,2),s=i[0],u=i[1];return e.push("".concat(s,"=").concat(a.processValue(u,t,r))),e}),[]).join("&")}(b,i,void 0!==p?p:c?c.target.value:null):""),{credentials:P}).then((function(e){if(e.ok)return e.json();throw e})).then((function(e){return m&&l[m]?l[m](e):e})).then((function(e){if(r({type:"UPDATE_PROP",payload:{id:g||s,prop:"loading",value:!1}}),E)for(var t=0,a=Object.entries(E);t<a.length;t++){var o=n(a[t],2),i=o[0],u=o[1];r({type:"UPDATE_PROP",payload:{id:i,prop:"datasource",value:l&&l[u]&&l[u](e)}})}else r({type:"UPDATE_PROP",payload:{id:g||s,prop:"datasource",value:e}})})).catch((function(e){r({type:"UPDATE_PROP",payload:{id:g||s,prop:"loading",value:!1}}),e instanceof Response?e.text().then((function(e){console.error("Error while fetching datasource: ",e),r({type:"UPDATE_PROP",payload:{id:g||s,prop:"error",value:e}})})):(console.error("Error while fetching datasource: ",e),r({type:"UPDATE_PROP",payload:{id:g||s,prop:"error",value:e.message}}))}));break;case"SET_DATASOURCE":var j=e.meta,S=j.data,A=j.fieldId;r({type:"UPDATE_PROP",payload:{id:A||s,prop:"datasource",value:S}});break;case"SET_VALUE":var R=e.meta,C=null;void 0!==R?(R.value&&(C=R.value),R.name&&f&&f[R.name]&&(C=f[R.name]({event:c,value:p,id:s}))):C=void 0!==p?p:c&&c.target.value,r({type:"UPDATE_PROP",payload:{id:R&&R.fieldId||s,prop:"value",value:C}});break;case"CUSTOM":var _=e.meta;f&&f[_.name]&&f[_.name]({event:c,value:p,id:s});break;default:throw new Error("No valid data type provided in config")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.validator=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return e.reduce((function(e,a){switch(a.type){case n.ValidationTypes.REQUIRED:e[n.ValidationTypes.REQUIRED]=""===t||null==t?"This field is required":"";break;case n.ValidationTypes.REGEX:var o=a.meta.pattern;new RegExp(o).test(t)?e[n.ValidationTypes.REGEX]="":e[n.ValidationTypes.REGEX]="Field value doesn't match the pattern";break;case n.ValidationTypes.LENGTH:var i=a.meta,s=i.min,u=i.max;t.length<s?e[n.ValidationTypes.LENGTH]="Minimum length of ".concat(s," is needed"):t.length>u?e[n.ValidationTypes.LENGTH]="Maximum length of ".concat(u," is allowed"):e[n.ValidationTypes.LENGTH]="";break;case n.ValidationTypes.RANGE:var c=a.meta,l=c.min,d=c.max;e[n.ValidationTypes.RANGE]=t>l&&t<d?"":"The value should be in the range of ".concat(l," and ").concat(d);break;case n.ValidationTypes.JSON:try{JSON.parse(t),e[n.ValidationTypes.JSON]=""}catch(t){e[n.ValidationTypes.JSON]="Invalid JSON supplied"}break;case n.ValidationTypes.CUSTOM:var p=a.meta.name;if(r&&r.validators&&r.validators[p]){var f=r.validators[p](t);e[n.ValidationTypes.CUSTOM]=f||""}else console.error("No custom validator function specified")}return e}),{})}}])}));
//# sourceMappingURL=index.js.map